<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>사용자 정보 수정</title>
</head>
<body>
    <h3>사용자 정보 수정</h3>
    <form id="updateForm">
        <input type="text" id="uiNum" style="display:none;">
        <input type="text" id="uiName" placeholder="이름"><br>
        <input type="text" id="uiId" placeholder="아이디"><br>
        <input type="text" id="uiPwd" placeholder="비밀번호"><br>
        <input type="text" id="uiMobile" placeholder="휴대전화"><br>
        <input type="text" id="uiEmail" placeholder="이메일"><br>
        <input type="date" id="uiBirth" placeholder="생일"><br>
        <button type="button" onclick="saveUserInfo()">저장</button>
    </form>

    <script>
        async function getUserInfo() {
            const params = new URLSearchParams(window.location.search);
            const uiNum = params.get('uiNum');
            if (uiNum) {
                const res = await fetch(`/user-infos/${uiNum}`);
                const userInfo = await res.json();
                document.getElementById('uiNum').value = userInfo.uiNum;
                document.getElementById('uiName').value = userInfo.uiName;
                document.getElementById('uiId').value = userInfo.uiId;
                document.getElementById('uiPwd').value = userInfo.uiPwd;
                document.getElementById('uiMobile').value = userInfo.uiMobile;
                document.getElementById('uiEmail').value = userInfo.uiEmail;

                const formattedDate = formatDate(userInfo.uiBirth);
                document.getElementById('uiBirth').value = formattedDate;
            }
        }

        function formatDate(inputDate) {
            const year = inputDate.substring(0, 4);
            const month = inputDate.substring(4, 6);
            const day = inputDate.substring(6, 8);
            return `${year}-${month}-${day}`;
        }

        function saveUserInfo() {
            const uiNum = document.getElementById('uiNum').value;
            const uiName = document.getElementById('uiName').value;
            const uiId = document.getElementById('uiId').value;
            const uiPwd = document.getElementById('uiPwd').value;
            const uiMobile = document.getElementById('uiMobile').value;
            const uiEmail = document.getElementById('uiEmail').value;
            let uiBirth = document.getElementById('uiBirth').value;

            uiBirth = uiBirth.replace(/-/g, '');

            const user = {
                uiNum,
                uiName,
                uiId,
                uiPwd,
                uiMobile,
                uiEmail,
                uiBirth
            };

            fetch('/updateUserInfo', {
                method: 'POST',
                body: JSON.stringify(user),
                headers: {
                    'Content-Type': 'application/json;charset=UTF-8'
                }
            })
            .then(response => response.json())
            .then(data => {
                alert(data.msg);
                if (data.success) {
                    window.location.href = '/';
                }
            })
            .catch(error => console.error('사용자 정보 수정 오류:', error));
        }

        window.addEventListener('load', getUserInfo);
    </script>
</body>
</html>
